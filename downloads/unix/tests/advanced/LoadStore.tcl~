#
# Testing Cache events
#

# load the extension
load ./build/libperft.so

# initialize event set
perft::init [list PAPI_LD_INS PAPI_SR_INS  PAPI_TOT_INS]

# take a large random list
    set ls [list ]
    for { set i 0 } { $i < 1000000 } { incr i } {
        lappend ls [expr {rand()}]
    }

set script1 {
set ls [lreplace $ls 0 999999 $ls]
    }
set script1 [string repeat $script1 100000]

set script2 {
set a $ls
    }

set script2 [string repeat $script2 100000]


set script3 {
   set a 0
   incr a	
    }
set script3 [string repeat $script3 100000] 

set results [perft::run_script $script2]
puts "Load instructions ....... [expr [dict get $results PAPI_LD_INS]*100.0/[dict get $results PAPI_TOT_INS]]%"
puts $results


set results [perft::run_script $script1]
puts "Load instructions ....... [expr [dict get $results PAPI_LD_INS]*100.0/[dict get $results PAPI_TOT_INS]]%"
puts $results
#set results [perft::run_script $script3]
#puts "Load instructions ....... [expr [dict get $results PAPI_LD_INS]*100.0/[dict get $results PAPI_TOT_INS]]%"
#puts $results
